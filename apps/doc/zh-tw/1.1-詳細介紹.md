# MAA使用說明

## 功能介紹

### 一鍵長草：刷理智

- 若關卡選擇中沒有你需要的關卡，請在MAA中選擇 `當前/上次`，然後在遊戲中手動定位關卡，確保畫面停留在有 **開始按鈕** 和 **代理指揮** 的關卡詳情介面。
  - 若當前不處於此介面，則 `當前/上次` 會自動進入遊戲中“上次作戰”的關卡（以終端首頁右下角記錄為准）。
  - 也可以在 `設置` - `戰鬥設置` 中啟用 `手動輸入關卡名` 手動輸入關卡編號。目前支持導航的關卡有：
    - 全部主線關卡，可在關卡末尾添加 `-HARD` 或 `-NORMAL` 來切換標準或磨難難度
    - 龍門幣、作戰記錄的 5 / 6 關，但必須輸入 `CE-6` / `LS-6` ，會在第六關無法代理的情況下自動切換至第五關
    - 技能書、採購憑證、碳本第 5 關，必須輸入 `CA-5` / `AP-5` / `SK-5`
    - 晶片本，必須輸入完整關卡編號，如 `PR-A-1`
    - 剿滅作戰，必須輸入 `Annihilation`
    - 部分別傳，只支持 `OF-1` / `OF-F3` / `GT-5`
    - 當期 SS 活動 後三關，在自動訪問 [API](https://ota.maa.plus/MaaAssistantArknights/api/gui/StageActivity.json) 下載更新後會在主介面有相應提示

<details><summary>示例畫面</summary>

![示例畫面](https://user-images.githubusercontent.com/5153875/196309375-73a93b83-e59b-441c-913f-122d4a9fc46c.png)

</details>

- 主介面上的 `吃理智`、`吃石頭`、`指定次數`、`指定材料` 四個選項為**短路開關（或門）**，即 **四個選項中的任一條件** 達到，均會視為任務完成，停止刷理智。
  - 其中：
    - `吃理智` 指定吃理智藥的 **次數**（通常每次 1 份，即理智耗盡後開始作戰時遊戲默認選擇的一份；小樣由於理智較少可能會使用多次，請注意自行計算次數）
    - `吃石頭` 指定碎石多少次（每次 1 顆）
    - `指定次數` 指定刷多少次圖（例如“刷 15 次後停止”）
    - `指定材料` 指定刷多少個指定的材料（例如“獲取 5 個固源岩後停止”）

| 例 | 吃理智藥 | 吃石頭 | 指定次數 |  指定材料 | 結果                                                                                                                                          |
|:--:|:--------:|:------:|:--------:|:---------:|-----------------------------------------------------------------------------------------------------------------------------------------------|
|  A |    999   |   10   |     1    |     ✖     | 會嘗試吃理智藥和/或石頭，直到刷滿 **一次**，滿足了`指定次數：1`的條件，即視為任務完成，停止刷理智；如果一開始理智藥不夠、石頭不夠、現有的理智也不夠就會不刷圖自動結束。                                                                    |
|  B |     ✖    |    ✖   |    100   |     ✖     | 會嘗試刷滿100次，但在當前可用理智全部刷完後（可能只刷了幾次），由於滿足了`不吃理智藥`、`不吃石頭`的條件，無理智可用，視為任務完成，停止刷理智。           |
|  C |     1    |    ✖   |    100   |     ✖     | 會嘗試刷滿100次，期間最多吃 1 次理智藥，如果吃了一次理智藥理智也刷完了，由於滿足了`吃理智藥：1`、`不吃石頭`的條件，無理智可用，視為任務完成，停止刷理智。 |
|  D |    999   |    ✖   |    100   | 3個固源岩 | 會嘗試刷滿100次，期間會吃 999 次理智藥，但如果在這期間累計刷出了3個固源岩，由於滿足了`指定材料：3個固源岩`的條件，視為任務完成，停止刷理智。                             |

- `指定材料` 與 `關卡選擇` 是兩個互相獨立的邏輯。
  - `指定材料` 只是以材料個數作為任務完成依據，並不是說你指定了材料就會幫你導航到對應關卡。
- 支持未勾選 `代理指揮` 時自動勾選，避免你蹭信賴後忘記勾選的尷尬~
- 支持識別並顯示材料掉落，且會自動上傳 [企鵝物流數據統計](https://penguin-stats.cn/)，並可設置企鵝物流用戶 ID。
- 掉線後或淩晨 4 點閃斷後會自動重連，繼續刷選擇的關卡。
- 支持打完升級的情況；支持代理失敗的情況，會自動放棄本次行動。
- 剿滅相關：
  - 支持剿滅模式自動使用 `全權委託`。
  - MAA 會點擊終端首頁右上角剿滅按鈕進行跳轉，請確保當期剿滅已成功解鎖 `全權委託` 並 400 殺。
  - 每當當期剿滅刷新或重新安裝明日方舟時，從剿滅 `開始戰鬥` 頁面返回會自動展開 `情報匯總`，請提前關閉此頁面以防止任務卡住。
- 支持剩餘理智清空：
  - 主任務刷完後，自動跳到指定關卡清理剩餘的“邊角”理智（如剩下的理智拿來刷 1-7）。
  - 如果剩餘理智不夠清空（比如要刷 1-7 但連6理智都不夠）則會立即結束任務。

### 一鍵長草：基建換班

#### 換班策略

- 自動計算並選擇 **單設施內的最優解**，支援所有通用類技能和特殊技能組合；支援辨識經驗書、赤金、源石碎片、芯片，分別使用不同的幹員組合！

#### 基建工作心情閾值

- 自動識別心情進度條的百分比。如幹員心情小於該閾值，不會再去上班，直接進駐宿舍。

#### 特殊說明

- 基建換班目前均為單設施最優解，但非跨設施的全局最優解。例如 `巫戀+龍舌蘭`、`紅雲+稀音` 等這類單設施內的組合，都是可以正常辨識並使用的；`迷迭香`、`紅松騎士團` 這類多個設施間聯動的體系，暫不支援使用。
- 若 `無人機用途` 選擇 `貿易站-龍門幣` ，則將額外辨識是否有 `巫戀組`，並優先為其使用。
- 會客室僅缺一個線索時，會選擇對應流派的幹員；否則會選擇通用幹員。
- 會客室僅當自有線索滿時，才會送出線索，並且只送三個。有需要的同學可自行修改 `resource/tasks.json` 中 `SelectClue` - `maxTimes` 字段，自定義送出個數。
- 若不希望 `艾麗妮` 等幹員在訓練室未訓練時被進駐到宿舍，可在設置中打開 `不將已進駐幹員放入宿舍`。但可能會帶來加工站中心情不滿的幹員也不進駐宿舍的問題。
- 控制中樞策略太過複雜，目前只考慮 `阿米婭`、`詩懷雅`、`凱爾希`、`彩虹小隊` 及其他心情 +0.05 的幹員，後續逐步優化。

#### 自定義基建換班（測試功能）

- 一圖流的大佬們幫忙寫了一個 [排班生成器](https://yituliu.site/riicCal/)，可參考 [文檔](3.6-基建排班協議.md) 使用。
- 在 MAA 檔夾 `/resource/custom_infrast/` 下內置了幾套極限效率的作業，可用作參考。（全幹員且精二大佬可以試著直接用）

### 一鍵長草：獲取信用及購物

- 會自動訪問好友獲取信用點。
- 借助戰賺信用：
  - 使用助戰幹員通關一次火藍之心 `OF-1` 關卡，如果未解鎖該關卡請不要選擇該項。
  - 可以在 `resource\copilot\OF-1_credit_fight.json` 通過作業編輯器或直接修改 `OF-1自動戰鬥流程`（一般來說不建議修改）。
  - 關卡選擇為 `當前/上次` 時不生效。

### 一鍵長草：自動肉鴿

- 請在 MAA `設置` - `肉鴿設置` 中選擇所要探索的主題，否則可能會因為默認選擇最新一期主題而出現問題。
  - 請在遊戲內將對應肉鴿主題置頂在終端處。
  - 如果存在非目標主題的探索（如你打算用MAA刷水月，但現在還有一個未完成的傀影主題探索），請手動結束它。
  - 如果 MAA 在難度選擇介面卡住/反復進出，請先手動選好難度再啟動本功能。

- 設置中可選擇分隊、開局幹員（僅單個幹員名）等。
- 支持自動識別幹員及練度，並自動選擇較優幹員及技能。
- 支持識別商店物品，優先購買更厲害的收藏品。
- 支持掉線重連、支持淩晨 4 點更新後繼續回去刷。
- 戰鬥過程中如果刮痧了一直打不完，超過 5 分鐘會自動撤退所有地面單位；超過 6 分鐘會自動放棄當局戰鬥，不會卡住。
- 如果任務出現問題卡住了，會自動放棄當次探索並重試。但如果經常在某個地方卡住然後放棄、嚴重影響效率的，歡迎提個 issue 回饋一下~

### 自動戰鬥

- 歡迎使用作業分享站 [prts.plus](https://prts.plus)，[抄作業.com](https://抄作业.com) 使用&分享 作業檔！

#### 抄作業

- 本功能需要在有 `開始行動` 的編隊選擇介面開始運行。
- 若需要選擇助戰等，關閉 `自動編隊` 功能並手動編隊後再運行即可。
- 記得在作業分享站上給好用的作業點贊哦！

![image](https://user-images.githubusercontent.com/18511905/189662951-5f9d6d88-3c23-49b3-a58f-c35388b2d5d7.png)

#### 寫作業

- 可以在 [作業編輯器](https://prts.plus/create) 上製作，可參考 [文檔](3.3-戰鬥流程協議.md) 使用。
- 地圖座標獲取：填寫 `stage_name` 後直接開一局，會在目錄下生成 `map.png`，可以用於參考。也可參考 [PRTS.Map](https://map.ark-nights.com/areas) 網站，在設置中將 `座標展示` 修改為 `MAA` 後使用。
- 支持演習模式，不用一直浪費理智測試的。
- 推薦在作業描述裏填上你的署名（作者名）、參考的攻略視頻鏈接、其他想說的等等。
- 歡迎與我們一起討論作業製作等問題 [作業企鵝群 1169188429](https://jq.qq.com/?_wv=1027&k=QZcGcJ9G)。

#### 作業視頻識別

- 將視頻檔放入自動戰鬥中，點擊 '開始' 啟動作業視頻識別。
- 僅支持 16：9 解析度，且 720p 或更高，視頻內容不能出現黑框、異形屏校正、模擬器邊框等其他元素。

### 公開招募

- **自動公招和公招識別是兩個獨立的功能！**
- 自動公招支持使用 `加急許可`，全自動連續公招！請進入設置中選擇~
- 出 1、5、6 星都會彈出通知提示。
- 自動公招時自動選取數據上傳 [企鵝物流數據統計](https://penguin-stats.cn/) 和 [材料一圖流](https://yituliu.site/)。

### 倉庫識別（測試功能）

- 若自動跳轉失敗，請手動切換到倉庫 `養成材料` 介面開始功能。目前僅支持導出到[企鵝物流刷圖規劃器](https://penguin-stats.cn/planner)、[明日方舟工具箱](https://arkn.lolicon.app/#/material)、[明日方舟 - 幹員培養表](https://ark-nights.com/settings)，後面可能會用來做一些更實用的功能。（畫餅
- 如您是某個數據站站長，也歡迎聯繫我們適配貴站的材料 JSON 協議~

### 其他亂七八糟的說明

- 主介面上要執行的任務，是可以拖動改變順序的。同樣設置中基建換班的順序，也是可以拖動改變的。
- 主介面和設置中更改的配置一般都會自動保存，含有 `*` 號的選項除外。
- 所有點擊操作，都是點擊按鈕內隨機位置，並模擬泊松分佈（按鈕偏中間位置點的概率大，越往旁邊點到的概率越小）。
- 底層演算法純 C++ 開發，並設計了多重緩存技術，最大限度降低 CPU 和記憶體佔用。
- 軟體支持自動更新 ✿✿ヽ(°▽°)ノ✿ ，推薦非杠精的同學使用公測版，一般來說更新快且 bug 少。（什麼 MIUI (╯‵□′)╯︵┻━┻
- 如果新版本自動下載失敗，可手動下載 OTA 壓縮包後直接放到 MAA 目錄下，會自動更新的。
- 在 Windows 版本中，MAA 目錄下 `config` 檔夾中的 `gui.json` 記錄了各種設置，如果下載了新的完整包可以將此檔夾複製到新的 MAA 目錄下。（如果複製完啟動報錯可嘗試恢復 `bak` 備份檔或刪除後重新設置）。

## 其他功能

- 若需要多開模擬器同時操作，可將 MAA 檔夾複製多份，使用 **同一個 adb** 及 **不同的 adb 地址** 來進行連接。

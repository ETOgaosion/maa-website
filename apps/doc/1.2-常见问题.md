# 常见问题

## 软件无法运行/闪退/报错

### 可能性 0 : 下载的压缩包不完整

- 完整 MAA 软件压缩包命名格式为 "MAA-`版本`-`平台`-`架构`.zip"，其余均为无法单独使用的“零部件”，请仔细阅读。通常 Windows 用户只需下载 `MAA-*-win-x64.zip`。
- 若在某次自动更新后无法使用，可能是自动更新功能存在一些 bug, 可以尝试重新下载并解压完整包后手动迁移 `config` 文件夹。

### 可能性 1 : 运行库问题

- 请安装 [Visual C++ Redistributable](https://docs.microsoft.com/zh-CN/cpp/windows/latest-supported-vc-redist?view=msvc-160#visual-studio-2015-2017-2019-and-2022)、[.NET Framework 4.8](https://dotnet.microsoft.com/download/dotnet-framework/net48) 并重新启动计算机后再次尝试运行本软件。
- 若提示缺少 .NET Framework 4.8.1 （而非 .NET Framework 4.8），报错："This application requires one of the following versions of the .NET Farmework: .NET Framework,Version=v4.8.1"，一般来说，是由于错误的使用了 arm64 的 MAA，请下载 x64 的。即您需要下载 `MAA-*-win-x64.zip`，而非 `MAA-*-win-arm64.zip`

### 可能性 2 : 其它运行库问题

- 若正在使用 Windows Server 或其他精简版系统，可尝试使用 [Microsoft C++ 生成工具](https://visualstudio.microsoft.com/zh-hans/visual-cpp-build-tools/) 进行完整的开发环境配置（仅需要安装 .NET 及 C++ 开发环境）。

- **请注意，此项操作将会耗费 10GB 左右的磁盘空间，请务必在排查完其他可能性后使用。**

## 连接错误

- 提示：请参阅 [模拟器支持](1.3-模拟器支持.md) 确定正在使用的模拟器通过了支持性测试。
- 若使用了游戏加速器等软件，请关闭软件并 **重启电脑** 后再次尝试。
- 请检查您的解压软件 — 部分情况下使用如 `7z` 或 _其他小众解压软件_ 会导致 `Minitouch` 相关文件出错

### 方式 1 : 确认 adb 及连接地址正确

- 确认 MAA `设置` - `连接设置` - `adb 路径` 是否已自动填写，若已填写请忽略这步。若未填写：
  - 找到模拟器安装路径，Windows 可在运行模拟器时在任务管理器中右键进程点击 `打开文件所在的位置`。
  - 顶层或下层目录中大概率会有一个 `adb.exe`（不一定就叫这个名字，可能叫 `nox_adb.exe`；`HD-adb.exe`；`adb_server.exe` 等等，总之是名字带 `adb` 的 exe），搜索它，选择它！
- 确认连接地址填写正确。可在网上搜索正在使用的模拟器 adb 调试地址是什么，一般是类似 `127.0.0.1:5555` 这样的格式（雷电模拟器除外）。

#### 常见安卓模拟器adb端口

##### 单开情况/多开时首个模拟器

针对模拟器单开情况，参考各个模拟器文档和网易游戏高级游戏开发工程师@赵青青的[博客](https://www.cnblogs.com/zhaoqingqing/p/15238464.html)，常见安卓模拟器的 adb 端口如下：

|模拟器|主模拟器默认端口|
|-|:-:|
|网易 MuMu 模拟器 6/X|7555|
|网易 MuMu 模拟器 12|16384|
|夜神安卓模拟器|62001|
|逍遥安卓模拟器|21503|
|蓝叠安卓模拟器|5555|
|雷电安卓模拟器 9|5555 / emulator-5554|

纯数字的默认端口可以直接使用 `127.0.0.1:[port]` 来连接，雷电模拟器进行了封装，也可以使用 `emulator-5554` 进行连接。

在 Windows 与 Mac 的 `设置` - `连接设置` - `连接地址` 配置中如果有情况需要修改则可以参照上表。

##### 多开情况

- 夜神模拟器第一个设备端口 `62001` ，从第二个开始端口从 `62025` 开始递增；
- 网易 MuMu 模拟器 12 版本多开时 adb 端口无规律，可以通过点击 MuMu 多开器 12，启动需要运行的模拟器，点击右上角的 ADB 图标，即可查看当前正在运行的模拟器 adb 端口信息；
- 雷电模拟器从 9 版本开始，模拟器 adb 从本地端口 `5555` 开始逐个递增 2 ，比如第二个模拟器本地端口为 `5557` 。

### 方式 2 : 关闭冗余 adb 进程

- 关闭 MAA 后查找 `任务管理器` - `详细信息` 中有无名称包含 `adb` 的进程（通常和上文中填写的 `adb` 文件同名），如有，结束它后重试连接。

### 方式 3 : 重启电脑

- 重启能解决 99% 的问题。（确信

### 方式 4 : 换模拟器

- 请参阅 [模拟器支持](1.3-模拟器支持.md)。

## 连接正常，但是无操作

部分模拟器自带的 `adb` 版本过于老旧，不支持 `Minitouch` 相关操作。<br>

请使用管理员权限打开 MAA，点击 `MAA 设置` - `连接设置` - `强制替换 ADB`。（建议关闭模拟器并重启 MAA 后再操作，否则可能替换失败）<br>

模拟器更新后可能会重新覆盖 adb 文件。若更新后问题复现，请再次尝试替换。<br>

与替换 adb 相比，更推荐使用 [自定义连接](1.1-详细介绍.md#自定义连接)，一劳永逸。<br>

如果即使这样也无法正常使用，可将 `连接设置` - `触控模式` 从 `Minitouch` 切换到 `MaaTouch` 再次尝试。由于 `Adb Input` 操作过于缓慢，请仅将其作为万不得已的模式。

## 连接正常，但是操作卡顿、异常或频繁出错

- 若使用了 `异形屏UI适配`，请将其调整为 0。
- 若正在游玩非国服客户端，请先在 `设置` - `游戏设置` - `客户端类型` 中选择客户端版本。非国服部分功能可能并非完全适配，请参阅对应的外服使用文档。
- 若正在进行自动肉鸽，请参阅 [文档](1.1-详细介绍.md#一键长草：自动肉鸽)，并在 `设置` - `肉鸽设置` - `肉鸽主题` 中正确选择主题。
- `Adb Input` 触控模式操作缓慢为正常情况，如需自动战斗等请尝试切换其他模式。

## 自定义连接

### 方式 1 : 下载 adb 并手动设置连接

- （仅 Windows 用户）下载 [adb](https://dl.google.com/android/repository/platform-tools-latest-windows.zip) 并解压。推荐解压到 MAA 目录下。
- 进入软件 `设置` - `连接设置`，选择 `adb.exe` 的文件路径，填写 adb 地址（需要填写 IP + 端口，例如 `127.0.0.1:5555`），并选择模拟器类型。

### 方式 2 : 查找模拟器 adb 运行端口并连接

对于本身带有 adb 的模拟器，先按照 [确认 adb 地址一节](######方式-1-:-确认-adb-及连接地址正确) 找到 adb 可执行文件位置。

Mac 安卓模拟器一般安装在 `/Application/` 目录下，右键点击 `[模拟器名称].app` 后选择显示包内容，在目录下查找 adb 可执行文件即可。

#### 直接使用 adb 命令查看运行端口

**使用找到的 adb 可执行文件名替代下面命令中的 adb** ，而后执行：

```sh
# mac/linux/windows cmd
adb devices
# windows PowerShell
.\adb devices
```

大部分模拟器 adb 运行命令后将会按如下形式输出， `[ADBPORT]` 为具体数字：

```sh
List of devices attached
       127.0.0.1:[ADBPORT] device
# may be more output like the above one
```

使用 `127.0.0.1:[ADBPORT]` 作为连接地址即可（ `[ADBPORT]` 替换为实际数字）

#### 使用系统命令查看模拟器调试端口

若使用 adb 命令的输出结果并不能显示 `127.0.0.1:[port]` 形式的端口信息（比如 [雷电模拟器](#####单开情况/多开时首个模拟器) ），可以采取下面的方式查看：

首先运行一遍 adb 可执行程序（需要启动 adb daemon 进程），并且运行需要打开明日方舟应用的模拟器。

##### Windows 命令

可以使用 `win` + `R` 输入 `cmd` 打开命令行，使用如下命令查看:

```sh
for /F "tokens=1,2" %A in ('"tasklist | findstr "adb""') do ( ^
netstat -ano | findstr "%B" |)
```

##### Mac / Linux 命令

启动模拟器后在终端中输入：

```sh
tmp=$(sudo ps aux | grep "[a]db" | awk '{print $2}') && \
sudo netstat -vanp tcp | grep -e "\b$tmp"
```

将会输出如下形式结果，其中 `[PID]` 为 adb 实际运行的进程号，`[ADBPORT]` 为目标模拟器 adb 的远程连接端口，`[localport]` 为进程本地地址，无需关心（Mac 运行结果中也会有其他无需关心的指标）：

```sh
> ( netstat -ano | findstr "[PID]" )
 TCP  127.0.0.1:[localport]   127.0.0.1:0.0.0.0     LISTENING   [PID]
 TCP  127.0.0.1:[localport]   127.0.0.1:[ADBPORT]   ESTABLISHED [PID]
# ...
# maybe more output like the above line
```

使用结果中 `127.0.0.1:[ADBPORT]` （替换 `[ADBPORT]` 为实际数字）作为模拟器 adb 实际连接地址填入 `设置` - `连接设置` - `连接地址`。

## 文件下载速度慢

请尝试使用 [MAA 下载站](https://ota.maa.plus/MaaAssistantArknights/MaaRelease/releases/download/) 下载。<br>

我们的小水管带宽较低，且流量有限。虽然搭出来就是给大家用的，但也希望不要滥用，若 github 或其他镜像站可正常下载，建议优先选择。

## 下载到一半提示“登陆”/“鉴权”

请使用 浏览器 / IDM / FDM 等正规下载器下载文件，**不要用傻逼迅雷！**
